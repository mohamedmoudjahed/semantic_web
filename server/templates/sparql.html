{% extends "base.html" %}
{% block title %}SPARQL - Tolkien KG{% endblock %}

{% block content %}
<h2>SPARQL Query</h2>

{% if fuseki_mode %}
<div class="message success">
    <strong>âœ“ Using Fuseki SPARQL Endpoint</strong><br>
    <code>{{ fuseki_endpoint }}</code>
</div>
{% endif %}

<form method="post" class="sparql-form">
    <textarea name="query">{{ query }}</textarea>
    <button type="submit">Execute Query</button>
</form>

{% if error %}
<div class="message error">
    <strong>Error:</strong> {{ error }}
</div>
{% endif %}

{% if results %}
<div class="section">
    <h2>Results ({{ results|length }} rows)</h2>
    <table class="results-table">
        <thead>
            <tr>
                {% for v in vars %}
                <th>{{ v }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in results %}
            <tr>
                {% for cell in row %}
                <td>
                    {% if cell %}
                        {% if cell is string and cell.startswith('http') %}
                            <a href="{{ cell }}" target="_blank">{{ cell }}</a>
                        {% else %}
                            {{ cell }}
                        {% endif %}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="section">
    <h2>Example Queries</h2>
    <pre>
# Get all characters
SELECT ?entity ?label
WHERE {
    ?entity a tont:Character ;
            rdfs:label ?label .
}
LIMIT 20

# Characters with external links
SELECT ?entity ?label ?sameAs
WHERE {
    ?entity a tont:Character ;
            rdfs:label ?label ;
            owl:sameAs ?sameAs .
}
LIMIT 20

# Locations in a realm
SELECT ?location ?label ?realm
WHERE {
    ?location a tont:Location ;
              rdfs:label ?label ;
              tprop:realm ?realm .
}
LIMIT 20
    </pre>
</div>
{% endblock %}
